==============================
How to Boot from SPI Nor Flash
==============================

1. Two Boot Selections
======================

This document describes how to boot from SPI Nor Flash on the SG2044 board.

There are two ways to boot the SG2044 board: from SPI Nor Flash and from SD card.

How to boot from SD card is described `here <https://github.com/hconion/sophgo-doc/blob/main/SG2044/HowTo/A%20Simple%20Method%20to%20Install%20Ubuntu%20Image%20on%20SG2044%20EVB.rst#5-boot-from-microsd-card>`_.

When both the SD card and SPI Nor Flash are inserted and contain the necessary firmware for booting, the system prioritizes loading the binary firmware from the SD card into RAM.

To be short, if the SD card is present and contains the required firmware, the SG2044 board will boot from SD card.

When SD card is not inserted, the SG2044 board will boot from SPI Nor Flash.

2. Boot Process from SPI Nor Flash
=====================================

There are two SPI Nor Flash chips on the SG2044 board, SPI Nor Flash 0 and SPI Nor Flash 1. 

The first SPI Nor Flash is used to store ``firmware.bin``, and the second SPI Nor Flash is used to store the ``conf.ini``.

3. How to Burn or Update the ``firmware.bin`` in SPI Nor Flash 0
================================================================

``firmware.bin`` is the firmware image file that contains ``zsbl.bin``, ``fsbl.bin``, ``fw_dynamic.bin``, ``sg2044-evb.dtb``, ``SG2044.fd``.
The ``firmware.bin`` is generated by the ``build_rv_firmware_bin`` command.
It is stored in the ``install/soc_sg2044/single_chip/firmware`` directory.
If you want to boot the SG2044 board from SPI Nor Flash, you need to burn the ``firmware.bin`` into SPI Nor Flash 0.

To update the ``firmware.bin``, you need to use an SD card which can be used to boot the SG2044 board.

1. Put the new ``firmware.bin`` into media devices like SD card, USB flash drive, NVMe SSD, etc.

2. Use the SD card to boot the SG2044 board.

3. In the EDK II UEFI boot process, strike hotkey F2 to enter the UEFI Setup Menu.

4. Select "Firmware Management" -> "Update Firmware" -> Choose the Media Device -> Choose the File Location -> Confirm.
   Wait for a few seconds, and the system will update ``firmware.bin`` in SPI Nor Flash 0.

5. Boot the SG2044 board again, and this time the SD card is not needed.
